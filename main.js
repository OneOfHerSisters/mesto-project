(()=>{"use strict";var e={d:(t,n)=>{for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};function t(e){if("Escape"===e.key){var t=document.querySelector(".popup_opened");t&&o(t)}}function n(e){e.classList.add("popup_opened"),document.addEventListener("keydown",t)}function o(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",t)}e.d({},{bj:()=>x,Ml:()=>T,O9:()=>j,V2:()=>E,rC:()=>C,Xd:()=>D});var r={baseUrl:"https://nomoreparties.co/v1/plus-cohort-14",headers:{authorization:"1939a454-f819-4dfe-a512-f506105c67c3","Content-Type":"application/json"}};function c(){return fetch("".concat(r.baseUrl,"/users/me"),{headers:r.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)}))}var u=document.querySelector(".popup_content_photo"),a=u.querySelector(".popup__close-button"),i=document.querySelector("#place").content,s=u.querySelector(".popup__place-picture"),l=u.querySelector(".popup__place-title"),d=document.querySelector(".places");function f(e,t,o,c,a,d){var f=i.querySelector(".place").cloneNode(!0),p=f.querySelector(".place__picture"),_=f.querySelector(".place__likes");p.src=t,p.alt=e,f.querySelector(".place__title").textContent=e,_.textContent=o.length;var m=f.querySelector(".place__like-button");o&&o.some((function(e){return e._id==T}))&&m.classList.add("place__like-button_active"),m.addEventListener("click",(function(){var e;m.classList.contains("place__like-button_active")?(e=a,fetch("".concat(r.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:r.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)}))).then((function(e){_.textContent=e.likes.length})).then(m.classList.remove("place__like-button_active")):function(e){return fetch("".concat(r.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:r.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)}))}(a).then((function(e){_.textContent=e.likes.length})).then(m.classList.add("place__like-button_active"))}));var v=f.querySelector(".place__delete-button");return T!=c?v.classList.add("place__delete-button_disabled"):v.addEventListener("click",(function(){var e;e=a,fetch("".concat(r.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:r.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)})),f.remove()})),p.addEventListener("click",(function(){s.src=t,s.alt=e,l.textContent=e,n(u)})),f}function p(e,t,n){(function(e){return e.some((function(e){return!e.validity.valid}))})(e)||function(e){return e.some((function(e){return 0!==e.textContent.length}))}(e)?(t.classList.add(n.inactiveButtonClass),t.setAttribute("disabled","disabled")):(t.classList.remove(n.inactiveButtonClass),t.removeAttribute("disabled","disabled"))}function _(e,t){p(Array.from(e.querySelectorAll(t.inputSelector)),e.querySelector(t.submitButtonSelector),t)}a.addEventListener("click",(function(){o(u)})),fetch("".concat(r.baseUrl,"/cards"),{headers:r.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)})).then((function(e){e.forEach((function(e){d.append(f(e.name,e.link,e.likes,e.owner._id,e._id))}))}));var m,v=document.querySelector(".popup_content_place"),h=(document.querySelector(".popup_content_photo"),document.querySelector(".popup_content_avatar")),y=h.querySelector(".form"),S=v.querySelector(".form"),b=document.querySelector(".popup_content_profile"),q=b.querySelector(".form"),L=document.querySelector(".profile__edit-button"),k=document.querySelector(".profile__add-button"),C=document.querySelector(".profile__name"),E=document.querySelector(".profile__about"),g=document.querySelector(".profile__picture"),j=q.querySelector(".form__input_content_name"),x=q.querySelector(".form__input_content_about"),A=S.querySelector(".form__input_content_name"),P=S.querySelector(".form__input_content_about"),U=document.querySelector(".places"),B=document.querySelectorAll(".popup"),O=document.querySelector(".form__input_content_avatar"),T="406c1766e82c89a03ddcef32",D={formSelector:".form",inputSelector:".form__input",submitButtonSelector:".form__button",inactiveButtonClass:"form__button_inactive",inputErrorClass:"form__input_type_error",errorClass:"form__input-error_active"};function w(e,t,n){e.textContent=n?"Сохранение...":t}q.addEventListener("submit",(function(e){var t=q.querySelector(D.submitButtonSelector);w(t,"Сохранить",!0),e.preventDefault(),function(e,t){return fetch("".concat(r.baseUrl,"/users/me"),{method:"PATCH",headers:r.headers,body:JSON.stringify({name:e.value,about:t.value})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)}))}(j,x).then(c().then((function(e){C.textContent=e.name,E.textContent=e.about,g.setAttribute("src",e.avatar)}))).then(o(b)).finally((function(){return w(t,"Сохранить",!1)}))})),S.addEventListener("submit",(function(e){var t=S.querySelector(D.submitButtonSelector);w(t,"Создать",!0),e.preventDefault(),function(e,t){return fetch("".concat(r.baseUrl,"/cards"),{method:"POST",headers:r.headers,body:JSON.stringify({name:e.value,link:"".concat(t.value)})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)}))}(A,P).then((function(e){U.prepend(f(e.name,e.link,[],T,"")),S.reset(),o(v)})).finally((function(){return w(t,"Создать",!1)}))})),y.addEventListener("submit",(function(e){var t=y.querySelector(D.submitButtonSelector);w(t,"Сохранить",!0),e.preventDefault(),function(e){return fetch("".concat(r.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:r.headers,body:JSON.stringify({avatar:"".concat(e.value)})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)}))}(O).then((function(){return y.reset()})).then((function(e){c().then((function(e){C.textContent=e.name,E.textContent=e.about,g.setAttribute("src",e.avatar)}))})).then((function(){return o(h)})).finally((function(){return w(t,"Сохранить",!1)}))})),B.forEach((function(e){e.addEventListener("mousedown",(function(t){t.target.classList.contains("popup_opened")&&o(e),t.target.classList.contains("popup__close-button")&&o(e)}))})),L.addEventListener("click",(function(){n(b),j.value=C.textContent,x.value=E.textContent})),k.addEventListener("click",(function(){n(v),_(v,D)})),m=D,Array.from(document.querySelectorAll(m.formSelector)).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);n.forEach((function(r){r.addEventListener("input",(function(c){!function(e,t,n){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),o.classList.remove(n.errorClass),o.textContent=""}(e,t,n):function(e,t,n,o){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.add(o.inputErrorClass),r.textContent=n,r.classList.add(o.errorClass)}(e,t,t.validationMessage,n)}(e,r,t),p(n,o,t)}))}))}(e,m)})),c().then((function(e){C.textContent=e.name,E.textContent=e.about,g.setAttribute("src",e.avatar)}));var M=document.querySelector(".profile__edit-picture");g.addEventListener("mouseover",(function(){M.style.display="block"})),g.addEventListener("mouseout",(function(){M.style.display="none"})),M.addEventListener("click",(function(){n(h),_(h,D)}))})();